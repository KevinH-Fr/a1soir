<div id="<%= dom_id demande_cabine_essayage %>" class="my-2">
  <div class="card mx-2 mb-3 light-beige-colored shadow-sm">
    <div class="card-body p-1">

        <div class="card-title d-flex">
          <div data-turbo="false">
            <%= link_to admin_demande_cabine_essayage_path(demande_cabine_essayage), class: "text-decoration-none text-dark" do %>
              <%= custom_badge("", "", "", "fw-bold", demande_cabine_essayage.full_name) if demande_cabine_essayage.full_name.present? %>
            <% end %>
          </div>
          <%= badge_statut_demande_cabine(demande_cabine_essayage.statut) %>
          <%= custom_badge("fa-calendar", "", "", "", " envoyée le #{demande_cabine_essayage.created_at.strftime('%d/%m/%Y %H:%M')}") %>
          <%= custom_badge("fa-calendar-xmark", "", "", "", demande_cabine_essayage.evenement) if demande_cabine_essayage.evenement.present?%>
          <%= custom_badge("", "", "", "", "#{demande_cabine_essayage.produits.count} produit#{'s' if demande_cabine_essayage.produits.count > 1}") if demande_cabine_essayage.produits.any? %>

          <%= link_to "", "#collapseDemande#{dom_id(demande_cabine_essayage)}", 
                class: "btn btn-sm btn-outline-primary bi bi-eye m-1", "data-bs-toggle": "collapse", 
                role: "button", "aria-expanded": "false", "aria-controls": "collapseDemande#{dom_id(demande_cabine_essayage)}" %>

        </div>

        <div class="text-end">
          <%= links_record(demande_cabine_essayage) %>  
        </div>


  
      <div class="collapse px-2" id="collapseDemande<%= dom_id(demande_cabine_essayage) %>">

        <hr>

        <%= field_with_label("Email: ", demande_cabine_essayage.mail) if demande_cabine_essayage.mail.present? %>
        <%= field_with_label("Téléphone: ", demande_cabine_essayage.telephone) if demande_cabine_essayage.telephone.present? %>
        <%= field_with_label("Événement: ", demande_cabine_essayage.evenement) if demande_cabine_essayage.evenement.present? %>
        <%= field_with_label("Date événement: ", demande_cabine_essayage.date_evenement&.strftime('%d/%m/%Y')) if demande_cabine_essayage.date_evenement.present? %>
        <%= field_with_label("Statut: ", demande_cabine_essayage.statut) if demande_cabine_essayage.statut.present? %>
        <%= field_with_label("Commentaires: ", demande_cabine_essayage.commentaires) if demande_cabine_essayage.commentaires.present? %>

        <% if demande_cabine_essayage.disponibilites.present? %>
          <hr>
          <h6 class="fw-bold small text-muted">Disponibilités du client</h6>
          <div class="d-flex flex-wrap gap-2">
            <% demande_cabine_essayage.disponibilites.each do |slot| %>
              <% jour_slug, creneau_slug = slot.to_s.split("_", 2) %>
              <% jour_label = {
                "mardi" => "Mardi",
                "mercredi" => "Mercredi",
                "jeudi" => "Jeudi",
                "vendredi" => "Vendredi",
                "samedi" => "Samedi"
              }[jour_slug] || jour_slug.to_s.humanize %>
              <% creneau_label = {
                "matin" => "Matin",
                "apres_midi" => "Après-midi",
                "fin_de_journee" => "Fin de journée"
              }[creneau_slug] || creneau_slug.to_s.humanize %>
              <%= field_with_label("#{jour_label}:", creneau_label) %>
            <% end %>
          </div>
        <% end %>

        <hr>

        <h6 class="fw-bold small text-muted">Produits demandés:</h6>
        <% if demande_cabine_essayage.produits.any? %>
          <div class="row g-2">
            <% demande_cabine_essayage.produits.each do |produit| %>
              <div class="col-12 col-md-6 col-lg-4">
                <div class="card p-1 light-beige-colored shadow-sm">
                  <div class="d-flex align-items-center">
                    <div class="me-1">
                      <%= image_tag(produit.default_image, width: 40, class: "rounded") %>
                    </div>
                    <div class="flex-grow-1" style="min-width: 0;">
                      <h6 class="mb-0 fw-bold small" style="font-size: 0.85rem;"><%= produit.nom %></h6>
                      <div class="d-flex flex-wrap gap-1 mt-1">
                        <%= badge_taille_produit(produit) if produit.taille.present? %>
                        <%= badge_couleur_produit(produit) if produit.couleur.present? %>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="text-muted">Aucun produit</p>
        <% end %>

        <div class="text-end my-1">
          <%= button_to create_client_admin_demande_cabine_essayage_path(demande_cabine_essayage),
                class: "btn btn-sm btn-outline-secondary d-inline-flex align-items-center gap-2",
                method: :post,
                data: { turbo_confirm: "Créer un client à partir de cette demande ?" },
                form: { data: { turbo_frame: "_top" } } do %>
              <i class="bi bi-person-plus"></i>
              <span>Créer client depuis cette demande</span>
          <% end %>
        </div>        
      </div>

    </div>

  </div>

</div>

