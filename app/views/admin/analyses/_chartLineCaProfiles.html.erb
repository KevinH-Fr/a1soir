<div class="chartBox mx-auto">
  <canvas id="myChartLineCaProfiles"></canvas>
</div>

<script>
  document.addEventListener("turbo:load", function () {
    const canvas = document.getElementById('myChartLineCaProfiles');

    // ✅ Détruire l'ancienne instance si elle existe
    if (canvas.chartInstance) {
      canvas.chartInstance.destroy();
    }

    const dataLinePaiementsProfiles = <%= @chart_line_profiles_data.to_json.html_safe %>;

    let delayedLinePaiementsProfiles;

    const configLinePaiementsProfiles = {
      type: 'line',
      data: dataLinePaiementsProfiles,
      options: {
        aspectRatio: 1,
        animation: {
          onComplete: () => {
            delayedLinePaiementsProfiles = true;
          },
          delay: (context) => {
            let delay = 0;
            if (context.type === 'data' && context.mode === 'default' && !delayedLinePaiementsProfiles) {
              delay = context.dataIndex * 100 + context.datasetIndex * 10;
            }
            return delay;
          }
        },
        plugins: {
          legend: {
            display: true,
            position: 'bottom'
          },
          title: {
            display: true,
            text: "Chiffre d'affaires",
            font: {
              size: 14
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function (value) {
                return value;
              }
            }
          }
        }
      }
    };

    // ✅ Stocker l’instance dans le canvas pour pouvoir la détruire plus tard
    canvas.chartInstance = new Chart(canvas, configLinePaiementsProfiles);
  });
</script>
