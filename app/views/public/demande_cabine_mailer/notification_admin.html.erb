<div style="font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;">
  <p><strong>Nouvelle demande d’essayage reçue.</strong></p>

  <p>
    <% if @demande.respond_to?(:prenom) || @demande.respond_to?(:nom) %>
      Demandeur : <%= [@demande.try(:prenom), @demande.try(:nom)].compact.join(' ') %><br>
    <% end %>
    Email : <%= @demande.try(:mail) %><br>
    Téléphone : <%= @demande.try(:telephone) %>
  </p>

  <% if @demande.respond_to?(:evenement) && @demande.evenement.present? %>
    <p>Événement : <%= @demande.evenement %></p>
  <% end %>
  <% if @demande.respond_to?(:date_evenement) && @demande.date_evenement.present? %>
    <p>Date événement : <%= @demande.date_evenement %></p>
  <% end %>
  <% if @demande.respond_to?(:commentaires) && @demande.commentaires.present? %>
    <p>Commentaires : <%= @demande.commentaires %></p>
  <% end %>

  <% if @demande.respond_to?(:disponibilites) && @demande.disponibilites.present? %>
    <h4 style="margin-top: 16px;">Disponibilités proposées</h4>
    <ul style="margin: 8px 0; padding-left: 18px;">
      <% @demande.disponibilites.each do |slot| %>
        <% jour_slug, creneau_slug = slot.to_s.split("_", 2) %>
        <% jour_label = {
          "mardi" => "Mardi",
          "mercredi" => "Mercredi",
          "jeudi" => "Jeudi",
          "vendredi" => "Vendredi",
          "samedi" => "Samedi"
        }[jour_slug] || jour_slug.to_s.humanize %>
        <% creneau_label = {
          "matin" => "Matin",
          "apres_midi" => "Après-midi",
          "fin_de_journee" => "Fin de journée"
        }[creneau_slug] || creneau_slug.to_s.humanize %>
        <li><strong><%= jour_label %></strong> — <%= creneau_label %></li>
      <% end %>
    </ul>
  <% end %>

  <%# Produits demandés %>
  <% if @demande.respond_to?(:demande_cabine_essayage_items) && @demande.demande_cabine_essayage_items.any? %>
    <h4 style="margin-top: 16px;">Produits demandés</h4>
    <ul style="margin: 8px 0; padding-left: 18px;">
      <% @demande.demande_cabine_essayage_items.each do |item| %>
        <% produit = (item.respond_to?(:produit) && item.produit.present?) ? item.produit : (defined?(Produit) ? Produit.find_by(id: item.produit_id) : nil) %>
        <% if produit.present? %>
          <li>
            <strong><%= produit.nom %></strong>
            <% if produit.try(:taille)&.respond_to?(:nom) %>
              — Taille: <%= produit.taille.nom %>
            <% end %>
            <% if produit.try(:couleur)&.respond_to?(:nom) %>
              — Couleur: <%= produit.couleur.nom %>
            <% end %>
            <% if produit.respond_to?(:reference) && produit.reference.present? %>
              — Réf: <%= produit.reference %>
            <% end %>
          </li>
        <% else %>
          <li>Produit (ID: <%= item.produit_id %>) introuvable</li>
        <% end %>
      <% end %>
    </ul>
  <% end %>

  <hr>
  <p style="margin: 0; opacity: 0.8; font-size: 12px;">Message automatique d’alerte admin.</p>
</div>


