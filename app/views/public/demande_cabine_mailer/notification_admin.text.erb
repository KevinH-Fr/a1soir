Nouvelle demande d’essayage reçue.

Demandeur : <%= [@demande.try(:prenom), @demande.try(:nom)].compact.join(' ') %>
Email : <%= @demande.try(:mail) %>
Téléphone : <%= @demande.try(:telephone) %>

<% if @demande.respond_to?(:evenement) && @demande.evenement.present? %>
Événement : <%= @demande.evenement %>
<% end %>
<% if @demande.respond_to?(:date_evenement) && @demande.date_evenement.present? %>
Date événement : <%= @demande.date_evenement %>
<% end %>
<% if @demande.respond_to?(:commentaires) && @demande.commentaires.present? %>
Commentaires : <%= @demande.commentaires %>
<% end %>

<% if @demande.respond_to?(:disponibilites) && @demande.disponibilites.present? %>
Disponibilités proposées :
<% @demande.disponibilites.each do |slot| %>
  <% jour_slug, creneau_slug = slot.to_s.split("_", 2) %>
  <% jour_label = {
    "mardi" => "Mardi",
    "mercredi" => "Mercredi",
    "jeudi" => "Jeudi",
    "vendredi" => "Vendredi",
    "samedi" => "Samedi"
  }[jour_slug] || jour_slug.to_s.humanize %>
  <% creneau_label = {
    "matin" => "Matin",
    "apres_midi" => "Après-midi",
    "fin_de_journee" => "Fin de journée"
  }[creneau_slug] || creneau_slug.to_s.humanize %>
  - <%= jour_label %> — <%= creneau_label %>
<% end %>
<% end %>

<%# Produits demandés %>
<% if @demande.respond_to?(:demande_cabine_essayage_items) && @demande.demande_cabine_essayage_items.any? %>
Produits demandés :
<% @demande.demande_cabine_essayage_items.each do |item| %>
  <% produit = (item.respond_to?(:produit) && item.produit.present?) ? item.produit : (defined?(Produit) ? Produit.find_by(id: item.produit_id) : nil) %>
  <% if produit.present? %>
  - <%= produit.nom %><% if produit.try(:taille)&.respond_to?(:nom) %> — Taille: <%= produit.taille.nom %><% end %><% if produit.try(:couleur)&.respond_to?(:nom) %> — Couleur: <%= produit.couleur.nom %><% end %><% if produit.respond_to?(:reference) && produit.reference.present? %> — Réf: <%= produit.reference %><% end %>
  <% else %>
  - Produit (ID: <%= item.produit_id %>) introuvable
  <% end %>
<% end %>
<% end %>

--
Message automatique d’alerte admin.

